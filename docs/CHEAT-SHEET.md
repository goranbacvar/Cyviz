# Blazor Server Cheat Sheet

## Quick Reference Card

```
????????????????????????????????????????????????????????????????????????????
?                    BLAZOR SERVER DATABASE ACCESS                         ?
?                           CHEAT SHEET                                    ?
????????????????????????????????????????????????????????????????????????????

????????????????????????????????????????????????????????????????????????????
? THE GOLDEN RULE                                                          ?
?                                                                          ?
?  All C# code in Razor components runs ON THE SERVER, not in browser     ?
?                                                                          ?
?  Browser (HTML only) ??SignalR?? Server (C# code) ??EF Core?? SQLite   ?
????????????????????????????????????????????????????????????????????????????


????????????????????????????????????????????????????????????????????????????
?  BASIC PATTERN                                                           ?
????????????????????????????????????????????????????????????????????????????

@page "/devices"
@inject IDbContextFactory<AppDbContext> DbFactory

<h1>Devices</h1>
@foreach (var device in devices)
{
    <div>@device.Name</div>
}

@code {
    private List<Device> devices = new();

    protected override async Task OnInitializedAsync()
    {
        await using var db = await DbFactory.CreateDbContextAsync();
        devices = await db.Devices.ToListAsync();
    }
}


????????????????????????????????????????????????????????????????????????????
?  CRUD OPERATIONS                                                         ?
????????????????????????????????????????????????????????????????????????????

?? CREATE ??????????????????????????????????????????????????????????????????
? await using var db = await DbFactory.CreateDbContextAsync();             ?
? var device = new Device { Id = "...", Name = "..." };                    ?
? db.Devices.Add(device);                                                  ?
? await db.SaveChangesAsync();                                             ?
????????????????????????????????????????????????????????????????????????????

?? READ ????????????????????????????????????????????????????????????????????
? await using var db = await DbFactory.CreateDbContextAsync();             ?
? var devices = await db.Devices.ToListAsync();                            ?
? // OR                                                                    ?
? var device = await db.Devices.FindAsync(id);                             ?
????????????????????????????????????????????????????????????????????????????

?? UPDATE ??????????????????????????????????????????????????????????????????
? await using var db = await DbFactory.CreateDbContextAsync();             ?
? var device = await db.Devices.FindAsync(id);                             ?
? device.Name = "New Name";                                                ?
? await db.SaveChangesAsync();                                             ?
????????????????????????????????????????????????????????????????????????????

?? DELETE ??????????????????????????????????????????????????????????????????
? await using var db = await DbFactory.CreateDbContextAsync();             ?
? var device = await db.Devices.FindAsync(id);                             ?
? db.Devices.Remove(device);                                               ?
? await db.SaveChangesAsync();                                             ?
????????????????????????????????????????????????????????????????????????????


????????????????????????????????????????????????????????????????????????????
?  LIFECYCLE METHODS                                                       ?
????????????????????????????????????????????????????????????????????????????

protected override void OnInitialized()
    ? Component initialized (synchronous)

protected override async Task OnInitializedAsync()
    ? Component initialized (asynchronous) ? USE THIS FOR DB QUERIES

protected override void OnParametersSet()
    ? Parameters set/changed (synchronous)

protected override async Task OnParametersSetAsync()
    ? Parameters set/changed (asynchronous)

protected override void OnAfterRender(bool firstRender)
    ? After component rendered

protected override async Task OnAfterRenderAsync(bool firstRender)
    ? After component rendered (asynchronous)


????????????????????????????????????????????????????????????????????????????
?  COMMON QUERIES                                                          ?
????????????????????????????????????????????????????????????????????????????

// Get all
var devices = await db.Devices.ToListAsync();

// Get by ID
var device = await db.Devices.FindAsync(id);

// Filter
var onlineDevices = await db.Devices
    .Where(d => d.Status == DeviceStatus.Online)
    .ToListAsync();

// Order
var sorted = await db.Devices
    .OrderBy(d => d.Name)
    .ToListAsync();

// Select specific columns
var names = await db.Devices
    .Select(d => new { d.Id, d.Name })
    .ToListAsync();

// Count
var count = await db.Devices.CountAsync();

// Any
var hasDevices = await db.Devices.AnyAsync();

// First or default
var first = await db.Devices.FirstOrDefaultAsync();

// Include related data (if foreign keys exist)
var devices = await db.Devices
    .Include(d => d.Commands)
    .ToListAsync();

// Read-only (better performance)
var devices = await db.Devices
    .AsNoTracking()
    .ToListAsync();

// Pagination
var page = await db.Devices
    .Skip(pageIndex * pageSize)
    .Take(pageSize)
    .ToListAsync();


????????????????????????????????????????????????????????????????????????????
?  COMMON PITFALLS                                                         ?
????????????????????????????????????????????????????????????????????????????

? WRONG: Using synchronous methods
   var devices = db.Devices.ToList();  // Blocks thread

? CORRECT: Use async methods
   var devices = await db.Devices.ToListAsync();

?????????????????????????????????????????????????????????????????????????????

? WRONG: Forgetting StateHasChanged after update
   devices = await db.Devices.ToListAsync();  // UI won't update

? CORRECT: Call StateHasChanged
   devices = await db.Devices.ToListAsync();
   StateHasChanged();

?????????????????????????????????????????????????????????????????????????????

? WRONG: Not disposing DbContext
   var db = await DbFactory.CreateDbContextAsync();
   devices = await db.Devices.ToListAsync();  // Memory leak!

? CORRECT: Use await using
   await using var db = await DbFactory.CreateDbContextAsync();
   devices = await db.Devices.ToListAsync();

?????????????????????????????????????????????????????????????????????????????

? WRONG: Inject DbContext directly
   @inject AppDbContext db  // Lifetime issues

? CORRECT: Inject DbContextFactory
   @inject IDbContextFactory<AppDbContext> DbFactory


????????????????????????????????????????????????????????????????????????????
?  PERFORMANCE TIPS                                                        ?
????????????????????????????????????????????????????????????????????????????

? Use AsNoTracking() for read-only queries
   var devices = await db.Devices.AsNoTracking().ToListAsync();

? Project only needed columns
   var devices = await db.Devices
       .Select(d => new { d.Id, d.Name })
       .ToListAsync();

? Use async all the way
   await db.SaveChangesAsync();  // Not SaveChanges()

? Dispose DbContext properly
   await using var db = ...

? Use pagination for large lists
   .Skip(page * size).Take(size)

? Batch updates
   db.Devices.UpdateRange(devices);
   await db.SaveChangesAsync();


????????????????????????????????????????????????????????????????????????????
?  DEBUGGING                                                               ?
????????????????????????????????????????????????????????????????????????????

Enable EF Core SQL logging in appsettings.json:

{
  "Logging": {
    "LogLevel": {
      "Microsoft.EntityFrameworkCore.Database.Command": "Information"
    }
  }
}

Console will show:
  Executed DbCommand (2ms) [Parameters=[]]
  SELECT "d"."Id", "d"."Name" FROM "Devices" AS "d"


????????????????????????????????????????????????????????????????????????????
?  REAL-TIME UPDATES WITH SIGNALR                                          ?
????????????????????????????????????????????????????????????????????????????

@inject NavigationManager Navigation
@implements IAsyncDisposable

@code {
    private HubConnection? hubConnection;

    protected override async Task OnInitializedAsync()
    {
        hubConnection = new HubConnectionBuilder()
            .WithUrl(Navigation.ToAbsoluteUri("/controlhub"))
            .Build();

        hubConnection.On<Device>("DeviceUpdated", async (device) =>
        {
            // Update UI
            await InvokeAsync(StateHasChanged);
        });

        await hubConnection.StartAsync();
    }

    public async ValueTask DisposeAsync()
    {
        if (hubConnection is not null)
            await hubConnection.DisposeAsync();
    }
}


????????????????????????????????????????????????????????????????????????????
?  CHECKLIST                                                               ?
????????????????????????????????????????????????????????????????????????????

Before deploying:
? Use IDbContextFactory, not DbContext
? All database calls are async
? DbContext is disposed (await using)
? StateHasChanged() called after updates
? AsNoTracking() used for read-only queries
? Indexes on frequently queried columns
? Error handling implemented
? Null checks for async loading states
? SQL logging disabled in production


????????????????????????????????????????????????????????????????????????????
?  RESOURCES                                                               ?
????????????????????????????????????????????????????????????????????????????

?? Documentation:
   - docs/INDEX.md - Start here
   - docs/QUICK-REFERENCE.md - Code examples
   - docs/VISUAL-FLOW.md - Step-by-step diagrams
   - docs/DATA-FLOW.md - Complete guide
   - docs/ARCHITECTURE-DIAGRAMS.md - System architecture

?? External:
   - https://blazor-university.com/
   - https://docs.microsoft.com/aspnet/core/blazor/
   - https://docs.microsoft.com/ef/core/


????????????????????????????????????????????????????????????????????????????
?  REMEMBER                                                                ?
????????????????????????????????????????????????????????????????????????????

  Browser displays HTML ? SignalR ? Server executes C# ? Database

  The browser NEVER:
    ? Executes C# code
    ? Queries the database
    ? Sees connection strings

  The server ALWAYS:
    ? Executes all C# code
    ? Queries the database
    ? Generates HTML
    ? Sends HTML to browser via SignalR

???????????????????????????????????????????????????????????????????????????
```

## Quick Command Reference

### Create New Migration
```bash
dotnet ef migrations add MigrationName --project Cyviz
```

### Apply Migrations
```bash
dotnet ef database update --project Cyviz
```

### Remove Last Migration
```bash
dotnet ef migrations remove --project Cyviz
```

### View Migration SQL
```bash
dotnet ef migrations script --project Cyviz
```

### Drop Database
```bash
dotnet ef database drop --project Cyviz
```

---

**Print this cheat sheet or keep it handy while coding!** ??

