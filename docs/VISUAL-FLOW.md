# Visual Data Flow: Browser to Database

## Complete Round Trip Journey

This document shows the **exact path** data takes from the browser to SQLite and back.

---

## Scenario: User Views Device List

### Step-by-Step Visual Flow

```
????????????????????????????????????????????????????????????????????
? STEP 1: User Opens Browser                                        ?
????????????????????????????????????????????????????????????????????

    ?? User
     ?
     ? Types URL: https://localhost:5001/devices
     ?
     ?
???????????????????????????????????????
?   ?? Chrome Browser                 ?
?                                     ?
?   Address Bar:                      ?
?   https://localhost:5001/devices    ?
???????????????????????????????????????


????????????????????????????????????????????????????????????????????
? STEP 2: Browser Sends HTTP GET Request                            ?
????????????????????????????????????????????????????????????????????

???????????????????????????????????????
?   ?? Browser                        ?
???????????????????????????????????????
                  ?
                  ? HTTP GET /devices
                  ? Host: localhost:5001
                  ? Accept: text/html
                  ?
                  ?
???????????????????????????????????????
?   ???  ASP.NET Core Server           ?
?   (Kestrel)                         ?
?   Port: 5001                        ?
???????????????????????????????????????


????????????????????????????????????????????????????????????????????
? STEP 3: Server Routes to Blazor Page                              ?
????????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????
?   ASP.NET Core Routing Engine                               ?
?                                                             ?
?   Route: /devices ? Devices.razor                           ?
???????????????????????????????????????????????????????????????
                      ?
                      ? Matches: @page "/devices"
                      ?
                      ?
???????????????????????????????????????????????????????????????
?   ?? _Host.cshtml (Bootstrap Page)                          ?
?                                                             ?
?   <html>                                                    ?
?     <head>                                                  ?
?       <link rel="stylesheet" href="css/app.css" />         ?
?       <script src="_framework/blazor.server.js"></script>  ?
?     </head>                                                 ?
?     <body>                                                  ?
?       <app>                                                 ?
?         <component type="App" />                            ?
?       </app>                                                ?
?     </body>                                                 ?
?   </html>                                                   ?
???????????????????????????????????????????????????????????????
                      ?
                      ? Sends HTML to browser
                      ?
                      ?
???????????????????????????????????????????????????????????????
?   ?? Browser receives HTML                                  ?
?                                                             ?
?   <app>Loading...</app>                                     ?
?   <script src="_framework/blazor.server.js"></script>      ?
???????????????????????????????????????????????????????????????


????????????????????????????????????????????????????????????????????
? STEP 4: Browser Executes Blazor.js                                ?
????????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????
?   ?? Browser JavaScript Engine                              ?
?                                                             ?
?   blazor.server.js executes:                                ?
?   ????????????????????????????????????????????????????????  ?
?   ? 1. Connect to SignalR hub: wss://localhost:5001/_blazor?
?   ? 2. Negotiate connection protocol                      ?  ?
?   ? 3. Establish WebSocket connection                     ?  ?
?   ????????????????????????????????????????????????????????  ?
???????????????????????????????????????????????????????????????
                      ?
                      ? WebSocket Handshake
                      ? Upgrade: websocket
                      ?
                      ?
???????????????????????????????????????????????????????????????
?   ???  Server: SignalR Hub Manager                          ?
?                                                             ?
?   ? WebSocket connection established                       ?
?   Connection ID: abc-123-xyz                                ?
?   Creates Circuit for this session                          ?
???????????????????????????????????????????????????????????????


????????????????????????????????????????????????????????????????????
? STEP 5: Server Creates Blazor Component Instance                  ?
????????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?   ???  Server: Component Activation                              ?
?                                                                 ?
?   Route: /devices                                               ?
?     ?                                                           ?
?   Find Component: Devices.razor                                 ?
?     ?                                                           ?
?   Create Instance: new Devices()                                ?
?     ?                                                           ?
?   Resolve Dependencies (Dependency Injection):                  ?
?   ???????????????????????????????????????????????????????????? ?
?   ? @inject IDbContextFactory<AppDbContext> DbFactory        ? ?
?   ?         ?                                                ? ?
?   ?   Inject: IDbContextFactory<AppDbContext> instance       ? ?
?   ???????????????????????????????????????????????????????????? ?
?     ?                                                           ?
?   Component ready for initialization                            ?
???????????????????????????????????????????????????????????????????


????????????????????????????????????????????????????????????????????
? STEP 6: Component Lifecycle - OnInitializedAsync()                ?
????????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?   ?? Devices.razor Component (Running on Server)                ?
?                                                                 ?
?   @code {                                                       ?
?       private List<Device> devices = new();                     ?
?                                                                 ?
?       protected override async Task OnInitializedAsync()        ?
?       {                                                         ?
?           // ?? THIS LINE CREATES A DATABASE CONNECTION        ?
?           await using var db = await DbFactory                  ?
?               .CreateDbContextAsync();                          ?
?                                                                 ?
?           // ?? THIS LINE QUERIES THE DATABASE                 ?
?           devices = await db.Devices.ToListAsync();             ?
?       }                                                         ?
?   }                                                             ?
???????????????????????????????????????????????????????????????????
                      ?
                      ? Calls: DbFactory.CreateDbContextAsync()
                      ?
                      ?


????????????????????????????????????????????????????????????????????
? STEP 7: DbContextFactory Creates DbContext                        ?
????????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?   ?? IDbContextFactory<AppDbContext>                            ?
?                                                                 ?
?   Registered in Program.cs:                                     ?
?   builder.Services.AddDbContextFactory<AppDbContext>(          ?
?       opt => opt.UseSqlite("Data Source=app.db")               ?
?   );                                                            ?
?                                                                 ?
?   Creates new instance:                                         ?
?   ???????????????????????????????????????????????????????????? ?
?   ? var dbContext = new AppDbContext(options);               ? ?
?   ?   ?                                                      ? ?
?   ? DbContext configured with:                               ? ?
?   ?   - Provider: Microsoft.EntityFrameworkCore.Sqlite       ? ?
?   ?   - Connection String: Data Source=app.db                ? ?
?   ?   - Tracking: Enabled                                    ? ?
?   ?   - Logging: Configured                                  ? ?
?   ???????????????????????????????????????????????????????????? ?
???????????????????????????????????????????????????????????????????
                      ?
                      ? Returns: AppDbContext instance
                      ?
                      ?


????????????????????????????????????????????????????????????????????
? STEP 8: EF Core Translates LINQ to SQL                            ?
????????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?   ?? Entity Framework Core Query Translation                    ?
?                                                                 ?
?   C# LINQ Query:                                                ?
?   ???????????????????????????????????????????????????????????? ?
?   ? devices = await db.Devices.ToListAsync();                ? ?
?   ???????????????????????????????????????????????????????????? ?
?                                                                 ?
?   EF Core Steps:                                                ?
?   1??  Parse expression tree                                     ?
?   2??  Build query model                                         ?
?   3??  Apply SQLite-specific syntax                              ?
?   4??  Generate SQL command                                      ?
?                                                                 ?
?   Generated SQL:                                                ?
?   ???????????????????????????????????????????????????????????? ?
?   ? SELECT                                                   ? ?
?   ?   "d"."Id",                                              ? ?
?   ?   "d"."Name",                                            ? ?
?   ?   "d"."Type",                                            ? ?
?   ?   "d"."Protocol",                                        ? ?
?   ?   "d"."Capabilities",                                    ? ?
?   ?   "d"."Status",                                          ? ?
?   ?   "d"."LastSeenUtc",                                     ? ?
?   ?   "d"."Firmware",                                        ? ?
?   ?   "d"."Location",                                        ? ?
?   ?   "d"."RowVersion"                                       ? ?
?   ? FROM "Devices" AS "d"                                    ? ?
?   ???????????????????????????????????????????????????????????? ?
???????????????????????????????????????????????????????????????????
                      ?
                      ? Sends SQL to SQLite Provider
                      ?
                      ?


????????????????????????????????????????????????????????????????????
? STEP 9: SQLite Executes Query                                     ?
????????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?   ?? SQLite Database Engine                                     ?
?                                                                 ?
?   File: C:\...\Cyviz\app.db                                     ?
?                                                                 ?
?   Query Execution:                                              ?
?   ???????????????????????????????????????????????????????????? ?
?   ? 1. Open connection to app.db                             ? ?
?   ? 2. Parse SQL statement                                   ? ?
?   ? 3. Query planner analyzes query                          ? ?
?   ? 4. Check indexes: IX_Devices_Status_Type                 ? ?
?   ? 5. Read Devices table from disk                          ? ?
?   ? 6. Return result set (20 rows)                           ? ?
?   ???????????????????????????????????????????????????????????? ?
?                                                                 ?
?   Result Set (Binary Data):                                     ?
?   ???????????????????????????????????????????????????????????? ?
?   ? Row 1: device-01 | DisplayWall-1 | 0 | 1 | [...] | ...  ? ?
?   ? Row 2: device-02 | DisplayWall-2 | 1 | 0 | [...] | ...  ? ?
?   ? Row 3: device-03 | DisplayWall-3 | 0 | 1 | [...] | ...  ? ?
?   ? ...                                                      ? ?
?   ? Row 20: device-20 | DisplayWall-20 | 1 | 0 | [...] | .. ? ?
?   ???????????????????????????????????????????????????????????? ?
???????????????????????????????????????????????????????????????????
                      ?
                      ? Returns rows to EF Core
                      ?
                      ?


????????????????????????????????????????????????????????????????????
? STEP 10: EF Core Materializes Objects                             ?
????????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?   ?? Entity Framework Core Object Materialization               ?
?                                                                 ?
?   Receives binary data from SQLite                              ?
?     ?                                                           ?
?   For each row:                                                 ?
?   ???????????????????????????????????????????????????????????? ?
?   ? 1. Create new Device() instance                          ? ?
?   ? 2. Map columns to properties:                            ? ?
?   ?    - Id = "device-01"                                    ? ?
?   ?    - Name = "DisplayWall-1"                              ? ?
?   ?    - Type = (DeviceType)0  // Display                   ? ?
?   ?    - Protocol = (DeviceProtocol)1  // Extron            ? ?
?   ?    - Capabilities = JsonDeserialize(...)                ? ?
?   ?    - Status = (DeviceStatus)1  // Online                ? ?
?   ?    - LastSeenUtc = DateTime.Parse(...)                  ? ?
?   ?    - Firmware = "v1.2.3"                                 ? ?
?   ?    - Location = "ControlRoomA"                           ? ?
?   ? 3. Add to change tracker (if tracking enabled)          ? ?
?   ? 4. Add to List<Device>                                   ? ?
?   ???????????????????????????????????????????????????????????? ?
?     ?                                                           ?
?   Result: List<Device> with 20 Device objects                   ?
???????????????????????????????????????????????????????????????????
                      ?
                      ? Returns List<Device> to component
                      ?
                      ?


????????????????????????????????????????????????????????????????????
? STEP 11: Component Renders to HTML                                ?
????????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?   ?? Devices.razor Component                                    ?
?                                                                 ?
?   <h1>Devices</h1>                                              ?
?                                                                 ?
?   @if (devices == null)                                         ?
?   {                                                             ?
?       <p>Loading...</p>                                         ?
?   }                                                             ?
?   else                                                          ?
?   {                                                             ?
?       <table class="table">                                     ?
?           <thead>                                               ?
?               <tr>                                              ?
?                   <th>Name</th>                                 ?
?                   <th>Status</th>                               ?
?                   <th>Type</th>                                 ?
?               </tr>                                             ?
?           </thead>                                              ?
?           <tbody>                                               ?
?               @foreach (var device in devices)                  ?
?               {                                                 ?
?                   <tr>                                          ?
?                       <td>@device.Name</td>                     ?
?                       <td>@device.Status</td>                   ?
?                       <td>@device.Type</td>                     ?
?                   </tr>                                         ?
?               }                                                 ?
?           </tbody>                                              ?
?       </table>                                                  ?
?   }                                                             ?
?                                                                 ?
?   Razor Engine executes @foreach and generates HTML            ?
???????????????????????????????????????????????????????????????????
                      ?
                      ? Razor Template Engine Output
                      ?
                      ?
???????????????????????????????????????????????????????????????????
?   ?? Generated HTML (Server-Side)                               ?
?                                                                 ?
?   <h1>Devices</h1>                                              ?
?   <table class="table">                                         ?
?       <thead>                                                   ?
?           <tr>                                                  ?
?               <th>Name</th>                                     ?
?               <th>Status</th>                                   ?
?               <th>Type</th>                                     ?
?           </tr>                                                 ?
?       </thead>                                                  ?
?       <tbody>                                                   ?
?           <tr>                                                  ?
?               <td>DisplayWall-1</td>                            ?
?               <td>Online</td>                                   ?
?               <td>Display</td>                                  ?
?           </tr>                                                 ?
?           <tr>                                                  ?
?               <td>DisplayWall-2</td>                            ?
?               <td>Online</td>                                   ?
?               <td>Codec</td>                                    ?
?           </tr>                                                 ?
?           <!-- 18 more rows... -->                              ?
?       </tbody>                                                  ?
?   </table>                                                      ?
???????????????????????????????????????????????????????????????????
                      ?
                      ? Blazor computes diff (first render = full HTML)
                      ?
                      ?


????????????????????????????????????????????????????????????????????
? STEP 12: SignalR Sends HTML to Browser                            ?
????????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?   ???  Server: Blazor Hub                                        ?
?                                                                 ?
?   Computes Render Batch:                                        ?
?   ???????????????????????????????????????????????????????????? ?
?   ? Render Batch ID: 1                                       ? ?
?   ? Updates:                                                 ? ?
?   ?   - Component: Devices (id: 0)                           ? ?
?   ?   - Edits: [                                             ? ?
?   ?       { type: "prepend", content: "<h1>..." },           ? ?
?   ?       { type: "append", content: "<table>..." }          ? ?
?   ?     ]                                                    ? ?
?   ???????????????????????????????????????????????????????????? ?
?                                                                 ?
?   Serializes to binary format                                   ?
?     ?                                                           ?
?   Sends via SignalR WebSocket                                   ?
???????????????????????????????????????????????????????????????????
                      ?
                      ? WebSocket Message (Binary)
                      ? wss://localhost:5001/_blazor
                      ?
                      ?
???????????????????????????????????????????????????????????????????
?   ?? Browser: blazor.server.js                                  ?
?                                                                 ?
?   Receives render batch via WebSocket                           ?
?     ?                                                           ?
?   Deserializes binary message                                   ?
?     ?                                                           ?
?   Applies DOM updates:                                          ?
?   ???????????????????????????????????????????????????????????? ?
?   ? document.querySelector('app').innerHTML = `              ? ?
?   ?   <h1>Devices</h1>                                       ? ?
?   ?   <table class="table">                                  ? ?
?   ?     <thead>...</thead>                                   ? ?
?   ?     <tbody>                                              ? ?
?   ?       <tr><td>DisplayWall-1</td>...</tr>                 ? ?
?   ?       <tr><td>DisplayWall-2</td>...</tr>                 ? ?
?   ?       ...                                                ? ?
?   ?     </tbody>                                             ? ?
?   ?   </table>                                               ? ?
?   ? `;                                                       ? ?
?   ???????????????????????????????????????????????????????????? ?
???????????????????????????????????????????????????????????????????


????????????????????????????????????????????????????????????????????
? STEP 13: User Sees Data                                           ?
????????????????????????????????????????????????????????????????????

???????????????????????????????????????????????????????????????????
?   ?? Browser Viewport                                           ?
?                                                                 ?
?   ?????????????????????????????????????????????????????????   ?
?   ?  Devices                                              ?   ?
?   ?  ???????????????????????????????????????????????????  ?   ?
?   ?                                                       ?   ?
?   ?  Name            Status    Type                      ?   ?
?   ?  ?????????????????????????????????????????????       ?   ?
?   ?  DisplayWall-1   Online    Display                   ?   ?
?   ?  DisplayWall-2   Online    Codec                     ?   ?
?   ?  DisplayWall-3   Offline   Camera                    ?   ?
?   ?  DisplayWall-4   Online    Display                   ?   ?
?   ?  DisplayWall-5   Online    Codec                     ?   ?
?   ?  ...                                                  ?   ?
?   ?  DisplayWall-20  Online    Display                   ?   ?
?   ?                                                       ?   ?
?   ?????????????????????????????????????????????????????????   ?
?                                                                 ?
?   ?? User sees the table with 20 devices                        ?
???????????????????????????????????????????????????????????????????
```

---

## Key Observations

### ?? Security

```
? Browser NEVER has access to:
   - C# source code
   - Connection strings
   - SQL queries
   - Database file

? Browser ONLY receives:
   - HTML markup
   - CSS styles
   - JavaScript (blazor.server.js)
   - Rendered data as HTML strings
```

### ? Performance

```
Total roundtrip time: ~50-200ms

Breakdown:
- HTTP GET:              10-20ms
- Component init:        5-10ms
- Database query:        10-50ms  (SQLite is fast!)
- EF Core mapping:       10-30ms
- HTML rendering:        5-10ms
- SignalR transmission:  10-50ms
- DOM update:            5-10ms
```

### ?? Network Traffic

```
Initial Page Load:
- _Host.cshtml:          ~2 KB
- blazor.server.js:      ~30 KB
- CSS/fonts:             ~50 KB
- Total:                 ~82 KB

SignalR Data (after load):
- Render batch:          ~5-15 KB (compressed binary)
- WebSocket overhead:    ~100 bytes per message

Comparison:
- Blazor Server:         ~82 KB initial + ~5 KB updates
- Blazor WASM:           ~2 MB initial + ~1 KB API calls
- React SPA:             ~500 KB initial + ~1 KB API calls
```

---

## Summary Diagram

```
???????????????                                         ???????????????
?   Browser   ?                                         ?   SQLite    ?
?             ?                                         ?   Database  ?
?  (HTML/JS)  ?                                         ?  (app.db)   ?
???????????????                                         ???????????????
       ?                                                       ?
       ? 1. HTTP GET /devices                                 ?
       ?                                                       ?
       ?                                                       ?
?????????????????????????????????????????????????????????????????????
?                    ASP.NET CORE SERVER                            ?
?                                                                   ?
?  2. Route ? Devices.razor                                         ?
?                ?                                                  ?
?  3. Inject DbContextFactory                                       ?
?                ?                                                  ?
?  4. OnInitializedAsync()                                          ?
?                ?                                                  ?
?  5. Create DbContext ???????????????????????????????????????????  ?
?                ?                                               ?  ?
?  6. LINQ Query: db.Devices.ToListAsync()                       ?  ?
?                ?                                               ?  ?
?  7. EF Core translates to SQL ???????????????????????????????  ?  ?
?                ?                                            ?  ?  ?
?  8. SQL: SELECT * FROM Devices ????????????????????????????????????
?                ?                                            ?  ?  ?
?  9. SQLite reads app.db file ????????????????????????????????  ?  ?
?                ?                                               ?  ?
?  10. Returns 20 rows ???????????????????????????????????????????  ?
?                ?                                                  ?
?  11. EF Core maps to List<Device>                                 ?
?                ?                                                  ?
?  12. Razor renders HTML                                           ?
?                ?                                                  ?
?  13. SignalR sends HTML to browser                                ?
?                ?                                                  ?
?????????????????????????????????????????????????????????????????????
                 ?
                 ? 14. WebSocket: HTML diff
                 ?
       ??????????????????
       ?   Browser      ?
       ?                ?
       ?  15. Apply DOM ?
       ?      updates   ?
       ?                ?
       ?  16. User sees ?
       ?      table     ?
       ??????????????????
```

---

## The Bottom Line

**Everything happens on the server. The browser is just a display terminal.**

- ? C# code runs on server
- ? Database queries execute on server
- ? Business logic processes on server
- ? HTML is generated on server
- ? Browser only displays HTML and sends events
- ? Browser never executes C# or SQL
- ? Browser never sees connection strings or source code

This is the **core security and architectural principle** of Blazor Server: **zero trust in the client**.

